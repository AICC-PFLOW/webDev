<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search in DB</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
      </style>

</head>
<body>
    <h1>지역</h1>
    <form id="search_location">
        <button class="location" id="서울">서울</button>
        <button class="location" id="경기도">경기도</button> 
        <br>
        <button class="location" id="강원도">강원도</button>
        <button class="location" id="충청도">충청도</button>
    </form>
    <br>

    <h1>기술</h1>
    <form id="search_skill">
        <button class="skill" id="Git">Git</button>
        <button class="skill" id="MySQL">MySQL</button> 
        <br>
        <button class="skill" id="JavaScript">JavaScript</button>
        <button class="skill" id="Java">Java</button>
    </form>

    <h1>직무</h1>
    <form id="search_title">
        <button class="title" id="개발자">개발자</button>
        <button class="title" id="프론트">프론트</button> 
        <br>
        <button class="title" id="백엔드">백엔드</button>
        <button class="title" id="엔지니어">엔지니어</button>
    </form>

    <br><br>
    <form id="search">
        <button type="submit">찾기</button>
    </form>
    <!-- db 출력 -->
    <table id="allStudentsTable" style="display: none;">
        <thead>
            <tr>
                <th>Title</th>
                <th>skill</th>
                <th>location</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        const data = {}; // JSON 객체 초기화
        // location 저장
        document.getElementById('search_location').addEventListener('click',(e)=>{
            e.preventDefault();

            // const location = e.target.id;
            data['location'] = e.target.id; // data JSON 객체에 추가
            if(data) {
            console.log(`click location : ${data['location']}`);
            // console.log(JSON.stringify(data, null, 2));
            }
            else console.log('에러');
        })
        // skill 저장
        document.getElementById('search_skill').addEventListener('click',(e)=>{
            e.preventDefault();

            // if(data['skill']){ // data의 'skill'키에 value가 있는지 확인
            //     console.log(e.target.id);
            //     data['skill'].push(e.target.id); 
            // } else {
            //     data['skill'] = [e.target.id]; // data JSON 객체에 배열로 추가 ... 여러값을 입력 받을 때
            // }

            data['skill'] = e.target.id;

            if(data) {
            console.log(`click skill : ${data['skill']}`);
            // console.log(JSON.stringify(data, null, 2));
            }
            else console.log('에러');
        })
        // 직무 저장 (title에서 ?, info에서 ?)
        document.getElementById('search_title').addEventListener('click',(e)=>{
            e.preventDefault();

            data['title'] = e.target.id; // data JSON 객체에 추가
            if(data) {
            console.log(`click title : ${data['title']}`);
            // console.log(JSON.stringify(data, null, 2));
            }
            else console.log('에러');
        })

        // 수집한 data 전송
        document.getElementById('search').addEventListener('submit',async (e)=>{
            e.preventDefault();

            const respons = await fetch('/search',{
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            console.log('click "찾기"')

            if(respons.ok){
                const result = await respons.json();
                console.log(result.title);
                // table 태그 설정
                const tableBody = document.getElementById('allStudentsTable').getElementsByTagName('tbody')[0];
                tableBody.innerHTML = ''; // 기존 데이터 초기화

                result.forEach(search_data => {
                const row = document.createElement('tr');
                
                const titleCell = document.createElement('td');
                titleCell.textContent = search_data.title;
                row.appendChild(titleCell);

                const skillCell = document.createElement('td');
                skillCell.textContent = search_data.skill;
                row.appendChild(skillCell);

                const locationCell = document.createElement('td');
                locationCell.textContent = search_data.location;
                row.appendChild(locationCell);

                tableBody.appendChild(row);
                });
            document.getElementById('allStudentsTable').style.display = 'table';
            }
            else alert('데이터 전달 에러',Error);
        })
    </script>
</body>
</html>